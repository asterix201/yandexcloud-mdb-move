# Yandex.Cloud. Serverless-функция для переноса кластеров баз данных в другие сети
Данная функция переименовывает исходный кластер, а затем восстанавливает из последнего бекапа старый, при этом давая ему имя исходного.
1. [Создать сервисный аккаунт](https://cloud.yandex.ru/docs/iam/operations/sa/create)
1. [Выдать права доступа к кластерам БД](https://cloud.yandex.ru/docs/iam/operations/sa/assign-role-for-sa) (Роль *editor* на каталог)
1. [Создать функцию](https://cloud.yandex.ru/docs/functions/quickstart/function-quickstart). Для запуска кода из репозитория необходимо сохранить его содержимое в zip-архив и передать в форме редактирования после указания соответствующего метода загрузки, а также указать следующие параметры: 
  * *Среда выполнения* - python37
  * *Таймаут, c* - 300. Такой большой интервал нужен потому, что функция ожидает завершения операции переименования, прежде, чем восстанавливать кластер
  * *Сервисный аккаунт* - созданный ранее сервисный аккаунт
# Запуск и тестирование:
    curl -s -XPOST 'https://functions.yandexcloud.net/{function_id}?cluster_id={cluster_id}&subnet_id={subnet_id}' -H "Authorization: Bearer $(yc iam create-token)"
Query-Параметры для запуска:
1. *cluster_id* - ID изменяемого кластера
1. (repeatable) *subnet_id* - ID подсети VPC, в которой будет располагаться новый кластер
1. (optional) *new_name* - имя, под которым будет создан новый кластер. Без указания данного параметра, новый кластер будет называться, как и старый

Выводом функции будет ID операции создавния нового кластера из бекапа, либо Python-исключение